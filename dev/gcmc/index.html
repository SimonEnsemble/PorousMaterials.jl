<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>grand-canonical Monte Carlo simulations · PorousMaterials.jl</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script><link href="../assets/flux.css" rel="stylesheet" type="text/css"/></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit">PorousMaterials.jl</span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">PorousMaterials</a></li><li><a class="tocitem" href="../matter/">matter</a></li><li><a class="tocitem" href="../box/">boxes</a></li><li><a class="tocitem" href="../crystal/">crystals</a></li><li><a class="tocitem" href="../molecule/">molecules</a></li><li><a class="tocitem" href="../distance/">computing distances</a></li><li><a class="tocitem" href="../force_field/">forcefields</a></li><li><a class="tocitem" href="../eos/">equations of state</a></li><li><a class="tocitem" href="../henry/">Henry coefficients</a></li><li class="is-active"><a class="tocitem" href>grand-canonical Monte Carlo simulations</a><ul class="internal"><li><a class="tocitem" href="#Grand-canonical-Monte-Carlo-Simulations"><span>Grand-canonical Monte Carlo Simulations</span></a></li><li class="toplevel"><a class="tocitem" href="#detailed-docs"><span>detailed docs</span></a></li><li><a class="tocitem" href="#Grand-Canonical-Monte-Carlo-Simulations"><span>Grand-Canonical Monte Carlo Simulations</span></a></li></ul></li><li><a class="tocitem" href="../energy_min/">energy minimum</a></li><li><a class="tocitem" href="../grid/">grids</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>grand-canonical Monte Carlo simulations</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>grand-canonical Monte Carlo simulations</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/SimonEnsemble/PorousMaterials.jl/blob/master/docs/src/gcmc.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h2 id="Grand-canonical-Monte-Carlo-Simulations"><a class="docs-heading-anchor" href="#Grand-canonical-Monte-Carlo-Simulations">Grand-canonical Monte Carlo Simulations</a><a id="Grand-canonical-Monte-Carlo-Simulations-1"></a><a class="docs-heading-anchor-permalink" href="#Grand-canonical-Monte-Carlo-Simulations" title="Permalink"></a></h2><p>Simulate the adsorption of CO<span>$_2$</span> in FIQCEN_clean_min_charges (CuBTC) at 298 K at 1 bar using the Universal Force Field:</p><pre><code class="language-julia">using PorousMaterials

# read in xtal structure file and populate a Framework data structure
xtal = Crystal(&quot;FIQCEN_clean_min_charges.cif&quot;)
# remove numbers from atom labels
strip_numbers_from_atom_labels!(xtal)

# read in Lennard-Jones force field parameters and populate a LJForceField data structure
ljforcefield = LJForceField(&quot;UFF&quot;, r_cutoff=12.8)

# read in a molecule format file and populate a Molecule data structure
molecule = Molecule(&quot;CO2&quot;)

temperature = 298.0 # K
pressure = 1.0 # bar

# conduct Grand-Canonical Monte Carlo simulation
results, molecules = μVT_sim(xtal, molecule, temperature, pressure, forcefield,
            n_burn_cycles=5000, n_sample_cycles=5000)

# ... prints stuff
# results automatically saved to .jld2 load later in one line of code

# returns dictionary for easy querying
results[&quot;⟨N⟩ (molecules/unit cell)&quot;]   
results[&quot;err ⟨N⟩ (molecules)&quot;]         
results[&quot;Q_st (K)&quot;]                     </code></pre><p>Or, compute the entire adsorption isotherm at once, parallelized across many cores (this works by cleverly queuing a <a href="#PorousMaterials.μVT_sim"><code>μVT_sim</code></a> for each pressue across the specified number of cores for optimal efficiency):</p><pre><code class="language-julia">pressures = [0.2, 0.6, 0.8, 1.0] # bar

# loop over all pressures and compute entire adsorption isotherm in parallel
results = adsorption_isotherm(xtal, molecule, temperature, pressures, forcefield,
            n_burn_cycles=5000, n_sample_cycles=5000)</code></pre><p>Or, compute the adsorption isotherm in a step-wise manner, loading the molecules from the previous simulation to save on burn cycles:</p><pre><code class="language-julia"># loop over all pressures and run GCMC simulations in series.
# load in the configurations of the molecules from the previous pressure.
results = stepwise_adsorption_isotherm(xtal, molecule, temperature, pressures, forcefield,
               n_burn_cycles=1000, n_sample_cycles=5000)</code></pre><h1 id="detailed-docs"><a class="docs-heading-anchor" href="#detailed-docs">detailed docs</a><a id="detailed-docs-1"></a><a class="docs-heading-anchor-permalink" href="#detailed-docs" title="Permalink"></a></h1><h2 id="Grand-Canonical-Monte-Carlo-Simulations"><a class="docs-heading-anchor" href="#Grand-Canonical-Monte-Carlo-Simulations">Grand-Canonical Monte Carlo Simulations</a><a id="Grand-Canonical-Monte-Carlo-Simulations-1"></a><a class="docs-heading-anchor-permalink" href="#Grand-Canonical-Monte-Carlo-Simulations" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-binding" id="PorousMaterials.μVT_sim" href="#PorousMaterials.μVT_sim"><code>PorousMaterials.μVT_sim</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">results, molecules = μVT_sim(xtal, molecule, temperature, pressure,
                             ljff; molecules=Molecule[], settings=settings)</code></pre><p>Runs a grand-canonical (μVT) Monte Carlo simulation of the adsorption of a molecule in a xtal at a particular temperature and pressure using a Lennard Jones force field.</p><p>A cycle is defined as max(20, number of adsorbates currently in the system) Markov chain proposals. Current Markov chain moves implemented are particle insertion/deletion and translation.</p><p><strong>Arguments</strong></p><ul><li><code>xtal::Crystal</code>: the porous xtal in which we seek to simulate adsorption</li><li><code>molecule::Molecule</code>: a template of the adsorbate molecule of which we seek to simulate</li><li><code>temperature::Float64</code>: temperature of bulk gas phase in equilibrium with adsorbed phase   in the porous material. units: Kelvin (K)</li><li><code>pressure::Float64</code>: pressure of bulk gas phase in equilibrium with adsorbed phase in the   porous material. units: bar   the adsorption</li><li><code>ljff::LJForceField</code>: the molecular model used to describe the</li><li><code>molecules::Array{Molecule, 1}</code>: a starting configuration of molecules in the xtal.</li><li><code>n_burn_cycles::Int</code>: number of cycles to allow the system to reach   equilibrium before sampling.</li><li><code>n_sample_cycles::Int</code>: number of cycles used for sampling</li><li><code>sample_frequency::Int</code>: during the sampling cycles, sample e.g. the number of</li></ul><p>adsorbed gas molecules every this number of Markov proposals</p><ul><li><code>verbose::Bool</code>: whether or not to print off information during the simulation</li><li><code>ewald_precision::Float64</code>: desired precision for the long range Ewald summation</li><li><code>eos::Symbol</code>: equation of state to use for calculation of fugacity from pressure</li><li><code>write_adsorbate_snapshots::Bool</code>: whether the simulation will create and save a snapshot file</li><li><code>snapshot_frequency::Int</code>: the number of cycles taken between each snapshot (after burn cycle completion)</li><li><code>calculate_density_grid::Bool</code>: whether the simulation will keep track of a density grid for adsorbates</li><li><code>density_grid_dx::Float64</code>: The (approximate) space between voxels (in Angstroms) in the density grid. The number of voxels in the simulation box is computed automatically by <a href="../grid/#PorousMaterials.required_n_pts"><code>required_n_pts</code></a>.</li><li><code>density_grid_species::Symbol</code>: The atomic species within the <code>molecule</code> for which we will compute the density grid.</li><li><code>density_grid_sim_box::Bool</code>: <code>true</code> if we wish for the density grid to be over the </li></ul><p>entire simulation box as opposed to the box of the crystal passed in. <code>false</code> if we wish the density grid to be over the original <code>xtal.box</code>, before replication, passed in.</p><ul><li><code>results_filename_comment::AbstractString</code>: An optional comment that will be appended to the name of the saved file (if autosaved)</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/SimonEnsemble/PorousMaterials.jl/blob/fdc5cde7a34b05182f92453cacdb5a1f7ae71107/src/gcmc.jl#L120-L159">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PorousMaterials.adsorption_isotherm" href="#PorousMaterials.adsorption_isotherm"><code>PorousMaterials.adsorption_isotherm</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">results = adsorption_isotherm(xtal, molecule, temperature, pressures,
                              ljff; n_sample_cycles=5000,
                              n_burn_cycles=5000, sample_frequency=1,
                              verbose=true, ewald_precision=1e-6, eos=:ideal,
                              write_adsorbate_snapshots=false,
                              snapshot_frequency=1, calculate_density_grid=false,
                              density_grid_dx=1.0, density_grid_species=nothing,
                              density_grid_sim_box=true,
                              results_filename_comment=&quot;&quot;, show_progress_bar=false)</code></pre><p>Run a set of grand-canonical (μVT) Monte Carlo simulations in parallel. Arguments are the same as <a href="#PorousMaterials.μVT_sim"><code>μVT_sim</code></a>, as this is the function run in parallel behind the scenes. The only exception is that we pass an array of pressures. To give Julia access to multiple cores, run your script as <code>julia -p 4 mysim.jl</code> to allocate e.g. four cores. See <a href="https://docs.julialang.org/en/stable/manual/parallel-computing/#Parallel-Computing-1">Parallel Computing</a>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/SimonEnsemble/PorousMaterials.jl/blob/fdc5cde7a34b05182f92453cacdb5a1f7ae71107/src/gcmc.jl#L840-L856">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PorousMaterials.stepwise_adsorption_isotherm" href="#PorousMaterials.stepwise_adsorption_isotherm"><code>PorousMaterials.stepwise_adsorption_isotherm</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">results = stepwise_adsorption_isotherm(xtal, molecule, temperature, pressures,
                              ljff; n_sample_cycles=5000,
                              n_burn_cycles=5000, sample_frequency=1,
                              verbose=true, ewald_precision=1e-6, eos=:ideal,
                              write_adsorbate_snapshots=false,
                              snapshot_frequency=1, calculate_density_grid=false,
                              density_grid_dx=1.0, density_grid_species=nothing,
                              density_grid_sim_box::Bool=true,
                              results_filename_comment=&quot;&quot;, show_progress_bar=false)</code></pre><p>Run a set of grand-canonical (μVT) Monte Carlo simulations in series. Arguments are the same as <a href="#PorousMaterials.μVT_sim"><code>μVT_sim</code></a>, as this is the function run behind the scenes. An exception is that we pass an array of pressures. The adsorption isotherm is computed step- wise, where the ending configuration from the previous simulation (array of molecules) is passed into the next simulation as a starting point. The ordering of <code>pressures</code> is honored. By giving each simulation a good starting point, (if the next pressure does not differ significantly from the previous pressure), we can reduce the number of burn cycles required to reach equilibrium in the Monte Carlo simulation. Also see <a href="#PorousMaterials.adsorption_isotherm"><code>adsorption_isotherm</code></a> which runs the μVT simulation at each pressure in parallel.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/SimonEnsemble/PorousMaterials.jl/blob/fdc5cde7a34b05182f92453cacdb5a1f7ae71107/src/gcmc.jl#L776-L796">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PorousMaterials.μVT_output_filename" href="#PorousMaterials.μVT_output_filename"><code>PorousMaterials.μVT_output_filename</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">filename = μVT_output_filename(xtal, molecule, temperature, 
                               pressure, ljff, n_burn_cycles, 
                               n_sample_cycles; comment=&quot;&quot;, extension=&quot;.jld2&quot;)</code></pre><p>This is the function that establishes the file naming convention used by <a href="@ref">μVT_sim</a>.</p><p><strong>Arguments</strong></p><ul><li><code>xtal::Crystal</code>: porous xtal used in adsorption simulation</li><li><code>molecule::Molecule</code>: a template of the adsorbate molecule used in adsorption simulation</li><li><code>temperature::Float64</code>:temperature of bulk gas phase in equilibrium with adsorbed phase in       the porous material. units: Kelvin (K) </li><li><code>pressure::Float64</code>:pressure of bulk gas phase in equilibrium with adsorbed phase in the       porous material. units: bar</li><li><code>ljff::LJForceField</code>: the molecular model used in adsorption simulation</li><li><code>n_burn_cycles::Int</code>: number of cycles to allow the system to reach equilibrium before sampling.    </li><li><code>n_sample_cycles::Int</code>: number of cycles used for sampling</li><li><code>comment::String=&quot;&quot;</code>: remarks to be included in the filename</li><li><code>extension::String=&quot;.jld2&quot;</code>: the file extension</li></ul><p><strong>Returns</strong></p><ul><li><code>filename::String</code>: the name of the specific <code>.jld2</code> simulation file</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/SimonEnsemble/PorousMaterials.jl/blob/fdc5cde7a34b05182f92453cacdb5a1f7ae71107/src/gcmc.jl#L682-L704">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PorousMaterials.isotherm_sim_results_to_dataframe" href="#PorousMaterials.isotherm_sim_results_to_dataframe"><code>PorousMaterials.isotherm_sim_results_to_dataframe</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">dataframe = isotherm_sim_results_to_dataframe(desired_props, xtal,
                                              molecule, temperature,
                                              pressures, ljff,
                                              n_burn_cycles, n_sample_cycles;
                                              where_are_jld_files=nothing)`</code></pre><p>convert the <code>.jld2</code> results output files auto-saved from <a href="#PorousMaterials.μVT_sim"><code>μVT_sim</code></a> into a <code>DataFrame</code>. each row of the <code>DataFrame</code> corresponds to a pressure in the adsorption isotherm. <code>desired_props</code> is an array of desired properties from the results.  to locate the requested output files, this function calls <a href="#PorousMaterials.μVT_output_filename"><code>μVT_output_filename</code></a> to retrieve the file names.</p><p><strong>Arguments</strong></p><ul><li><code>desired_props::Array{String, 1}</code>: An array containing names of properties to be retrieved from the <code>.jld2</code> file</li><li><code>xtal::Crystal</code>: The porous crystal</li><li><code>molecule::Molecule{Cart}</code>: The adsorbate molecule</li><li><code>temperature::Float64</code>: The temperature in the simulation, units: Kelvin (K)</li><li><code>pressures::Array{Float64}</code>: The pressures in the adsorption isotherm simulation(s), units: bar</li><li><code>ljff::LJForceField</code>: The molecular model being used in the simulation to describe intermolecular Van       der Waals interactions</li><li><code>n_burn_cycles::Int64</code>: The number of burn cycles used in this simulation</li><li><code>n_sample_cycles::Int64</code>: The number of sample cycles used in the simulations</li><li><code>where_are_jld_files::Union{String, Nothing}=nothing</code>: The location to the simulation files. defaults to   <code>PorousMaterials.PATH_TO_SIMS</code>.</li><li><code>comment::String=&quot;&quot;</code>: comment appended to outputfilename</li></ul><p><strong>Returns</strong></p><ul><li><code>dataframe::DataFrame</code>: A <code>DataFrame</code> containing the simulated data along the adsorption isotherm, whose   columns are for the specified properties</li></ul><p><strong>Note</strong></p><p>A range of pressures can be used to select a batch of simulation files to be included in the <code>DataFrame</code>.</p><p><strong>Example</strong></p><pre><code class="language-julia">xtal = Crystal(&quot;SBMOF-1.cif&quot;)
molecule = Molecule(&quot;Xe&quot;)
ljff = LJForceField(&quot;UFF&quot;, mixing_rules=&quot;Lorentz-Berthelot&quot;)
temperature = 298.0 # K
pressures = 10 .^ range(-2, stop=2, length=15)

dataframe = isotherm_sim_results_to_dataframe([&quot;pressure (bar)&quot;, &quot;⟨N⟩ (mmol/g)&quot;], 
                                              xtal, molecule, temperature,
                                              pressures, ljff, 10000, 10000)
dataframe[Symbol(&quot;pressure (bar)&quot;)] # pressures
dataframe[Symbol(&quot;⟨N⟩ (mmol/g)&quot;)] # adsorption at corresponding pressures</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/SimonEnsemble/PorousMaterials.jl/blob/fdc5cde7a34b05182f92453cacdb5a1f7ae71107/src/gcmc.jl#L905-L953">source</a></section></article></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../henry/">« Henry coefficients</a><a class="docs-footer-nextpage" href="../energy_min/">energy minimum »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Sunday 16 May 2021 18:36">Sunday 16 May 2021</span>. Using Julia version 1.5.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
